{% extends "base.html" %}

{% block title %}Dashboard - Age-Normed MRIQC{% endblock %}

{% block content %}
<div class="row">
    <!-- Summary Cards -->
    <div class="col-12 mb-4">
        <div class="row" id="summary-cards">
            <div class="col-md-3 mb-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title" id="total-subjects">0</h4>
                                <p class="card-text">Total Subjects</p>
                            </div>
                            <div class="align-self-center">
                                <i class="bi bi-people fs-1"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title" id="pass-count">0</h4>
                                <p class="card-text">Passed QC</p>
                            </div>
                            <div class="align-self-center">
                                <i class="bi bi-check-circle fs-1"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title" id="warning-count">0</h4>
                                <p class="card-text">Warnings</p>
                            </div>
                            <div class="align-self-center">
                                <i class="bi bi-exclamation-triangle fs-1"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-3">
                <div class="card bg-danger text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title" id="fail-count">0</h4>
                                <p class="card-text">Failed QC</p>
                            </div>
                            <div class="align-self-center">
                                <i class="bi bi-x-circle fs-1"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Quality Distribution Chart -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-pie-chart"></i>
                    Quality Distribution
                </h5>
            </div>
            <div class="card-body">
                <canvas id="quality-distribution-chart" width="400" height="300"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Age Group Distribution Chart -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-bar-chart"></i>
                    Age Group Distribution
                </h5>
            </div>
            <div class="card-body">
                <canvas id="age-distribution-chart" width="400" height="300"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Metric Statistics -->
    <div class="col-md-8 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-graph-up"></i>
                    Quality Metrics Overview
                </h5>
                <div class="btn-group btn-group-sm" role="group">
                    <input type="radio" class="btn-check" name="metric-view" id="metric-view-box" autocomplete="off" checked>
                    <label class="btn btn-outline-primary" for="metric-view-box">Box Plot</label>
                    
                    <input type="radio" class="btn-check" name="metric-view" id="metric-view-scatter" autocomplete="off">
                    <label class="btn btn-outline-primary" for="metric-view-scatter">Scatter</label>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="metric-select" class="form-label">Select Metric:</label>
                    <select class="form-select" id="metric-select">
                        <option value="snr">SNR (Signal-to-Noise Ratio)</option>
                        <option value="cnr">CNR (Contrast-to-Noise Ratio)</option>
                        <option value="fber">FBER (Foreground-Background Energy Ratio)</option>
                        <option value="efc">EFC (Entropy Focus Criterion)</option>
                        <option value="fwhm_avg">FWHM Average</option>
                        <option value="qi1">QI1 (Quality Index 1)</option>
                        <option value="cjv">CJV (Coefficient of Joint Variation)</option>
                    </select>
                </div>
                <canvas id="metrics-chart" width="600" height="400"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-clock-history"></i>
                    Recent Activity
                </h5>
            </div>
            <div class="card-body">
                <div id="recent-activity" class="activity-feed">
                    <div class="text-muted text-center py-3">
                        <i class="bi bi-hourglass-split"></i>
                        <p class="mb-0">No recent activity</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Subject List Preview -->
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-table"></i>
                    Recent Subjects
                </h5>
                <a href="/subjects" class="btn btn-primary btn-sm">
                    View All Subjects
                    <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="recent-subjects-table">
                        <thead>
                            <tr>
                                <th>Subject ID</th>
                                <th>Age</th>
                                <th>Scan Type</th>
                                <th>Quality Status</th>
                                <th>Composite Score</th>
                                <th>Processed</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recent-subjects-tbody">
                            <tr>
                                <td colspan="7" class="text-center text-muted py-4">
                                    <i class="bi bi-inbox"></i>
                                    <p class="mb-0">No subjects processed yet</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Processing Status Modal -->
<div class="modal fade" id="processing-status-modal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Processing Status</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="processing-status-content">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Loading processing status...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/dashboard.js"></script>
{% endblock %}